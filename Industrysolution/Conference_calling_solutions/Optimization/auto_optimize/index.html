<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.2">
<title data-react-helmet="true">设备调优 | 聆思文档中心</title><meta data-react-helmet="true" property="og:url" content="https://github.com/LISTENAI/Industrysolution/Conference_calling_solutions/Optimization/auto_optimize"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="设备调优 | 聆思文档中心"><meta data-react-helmet="true" name="description" content="1.常用Lisa命令"><meta data-react-helmet="true" property="og:description" content="1.常用Lisa命令"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://github.com/LISTENAI/Industrysolution/Conference_calling_solutions/Optimization/auto_optimize"><link data-react-helmet="true" rel="alternate" href="https://github.com/LISTENAI/Industrysolution/Conference_calling_solutions/Optimization/auto_optimize" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://github.com/LISTENAI/Industrysolution/Conference_calling_solutions/Optimization/auto_optimize" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.990d7a46.css">
<link rel="preload" href="/assets/js/runtime~main.169e3d54.js" as="script">
<link rel="preload" href="/assets/js/main.d12433d4.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1knm">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" titleclassname="navbar__title" href="/"><img src="/img/logo_light.svg" alt="LSOpen Logo" class="themedImage_1WWj themedImage--light_1H0o navbar__logo"><img src="/img/logo_dark.svg" alt="LSOpen Logo" class="themedImage_1WWj themedImage--dark_2hTa navbar__logo"></a><a class="navbar__item navbar__link" href="/chips/4002/Chip_information_4002">芯片</a><a class="navbar__item navbar__link" href="/tools/LStudio">工具</a><a class="navbar__item navbar__link" href="/AIsolution/ESR/Quick_start/Scheme_introduction">AI应用方案</a><a class="navbar__item navbar__link" href="/Industrysolution/Scanning_pen/Scheme_introduction">行业解决方案</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/faq/faq">FAQ</a><a class="navbar__item navbar__link" href="/school/school">视频课程</a><a class="navbar__item navbar__link" href="/workorder/workorder">工单</a><div class="react-toggle displayOnlyInLargeViewport_3VZa react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_ZCuN"><img src="/img/light.svg" alt="" class="themedImage_1WWj themedImage--light_1H0o"><img src="/img/unlight.svg" alt="" class="themedImage_1WWj themedImage--dark_2hTa"></span></div><div class="react-toggle-track-x"><span class="toggle_ZCuN"><img src="/img/undark.svg" alt="" class="themedImage_1WWj themedImage--light_1H0o"><img src="/img/dark.svg" alt="" class="themedImage_1WWj themedImage--dark_2hTa"></span></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="navbar__search searchBarContainer_MM2z"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_s5VG searchBarLoadingRing_2jQk"><div></div><div></div><div></div><div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" titleclassname="navbar__title" href="/"><img src="/img/logo_light.svg" alt="LSOpen Logo" class="themedImage_1WWj themedImage--light_1H0o navbar__logo"><img src="/img/logo_dark.svg" alt="LSOpen Logo" class="themedImage_1WWj themedImage--dark_2hTa navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/chips/4002/Chip_information_4002">芯片</a></li><li class="menu__list-item"><a class="menu__link" href="/tools/LStudio">工具</a></li><li class="menu__list-item"><a class="menu__link" href="/AIsolution/ESR/Quick_start/Scheme_introduction">AI应用方案</a></li><li class="menu__list-item"><a class="menu__link" href="/Industrysolution/Scanning_pen/Scheme_introduction">行业解决方案</a></li><li class="menu__list-item"><a class="menu__link" href="/faq/faq">FAQ</a></li><li class="menu__list-item"><a class="menu__link" href="/school/school">视频课程</a></li><li class="menu__list-item"><a class="menu__link" href="/workorder/workorder">工单</a></li></ul></div></div></div></nav><nav class="navbar subnavbar--fixed-top sub-navbar"><div class="navbar__inner subnavbar__inner"><div class="navbar__items"><a class="subnavbar__item subnavbar__link" dirname="/Industrysolution" href="/Industrysolution/Scanning_pen/Scheme_introduction">扫描笔</a><a class="subnavbar__item subnavbar__link" dirname="/Industrysolution" href="/Industrysolution/Conference_calling_solutions/Quick_start/Scheme_introduction">通话降噪</a></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_2GEL"><aside class="docSidebarContainer_2S6d"><div class="sidebar_3rk8"><nav class="menu menu--responsive thin-scrollbar menu_1wJ3 menuWithAnnouncementBar_39W0" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_24hZ" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--first menu__link--sublist" type="first" href="#!">快速入门</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Industrysolution/Conference_calling_solutions/Quick_start/Scheme_introduction">方案介绍</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--first menu__link--sublist" type="first" href="#!">硬件设计</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Industrysolution/Conference_calling_solutions/Hardwaredevelopment/hardware_guide">硬件参考设计</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--first menu__link--sublist" type="first" href="#!">新建项目</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Industrysolution/Conference_calling_solutions/softwaredevelopment/create_project">使用 LISA 创建 4002NC 项目</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--first menu__link--sublist menu__link--active" type="first" href="#!">调优指导</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/Industrysolution/Conference_calling_solutions/Optimization/auto_optimize">设备调优</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3dT7"><div class="container padding-top--md padding-bottom--lg center-container"><div class="row"><div class="col docItemCol_3Jy6"><div class="docItemContainer_1Utn"><article><div class="markdown"><header><h1 class="h1Heading_2YTE">设备调优</h1></header><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1rmC" id="1常用lisa命令"></a>1.常用Lisa命令<a class="hash-link" href="#1常用lisa命令" title="Direct link to heading">#</a></h3><p><strong>编译：</strong> </p><ul><li>Lisa build 完整编译</li><li>Lisa task build：respak 编译respak包</li><li>Lisa task build：package 将bin文件打包成lpk烧录包</li></ul><p><strong>烧录：</strong> </p><ul><li>Lisa flash 完整lpk包烧录</li><li>Lisa flash -p master/respak 单独烧录bin文件
当仅修改respak或者master时，可单独烧录bin文件</li></ul><p><strong>示例：</strong>
修改adc增益后烧录：</p><ul><li>修改adc_gain参数并保存</li><li>Lisa task build：respak</li><li>Lisa task build：package</li><li>Lisa flash -p respak</li><li>重启机器</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1rmC" id="2如何设置设备输出音量的最大值和最小值"></a>2.如何设置设备输出音量的最大值和最小值<a class="hash-link" href="#2如何设置设备输出音量的最大值和最小值" title="Direct link to heading">#</a></h3><p>电脑端的音量0--100与castor设备代码的对应关系：</p><p>函数 task_i2s_spk.c中</p><div class="codeBlockContainer_3oNM"><div class="codeBlockContent_3GwO"><pre tabindex="0" class="prism-code language-undefined codeBlock_11GL thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_t3ov"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#define SPK_VOL_DB_MAX (0.0f)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#define SPK_VOL_DB_MIN (-25.f)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3j15 clean-btn">Copy</button></div></div><blockquote><p>说明：
SPK_VOL_DB_MAX为castor可以输出的音量最大db值。对应电脑音量调到100时。
SPK_VOL_DB_MIN为castor可以输出的音量最小db值。对应电脑音量调到0时。</p></blockquote><p>这两个值需要根据具体喇叭硬件的能力来确定。默认是 最大输出0db，最小输出-25db。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1rmC" id="3如何修改mic增益和回采增益"></a>3.如何修改mic增益和回采增益<a class="hash-link" href="#3如何修改mic增益和回采增益" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_3oNM"><div class="codeBlockContent_3GwO c"><pre tabindex="0" class="prism-code language-c codeBlock_11GL thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_t3ov"><span class="token-line" style="color:#bfc7d5"><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">config</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">application</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">lini</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3j15 clean-btn">Copy</button></div></div><p>当前增益参数值:</p><div class="codeBlockContainer_3oNM"><div class="codeBlockContent_3GwO json"><pre tabindex="0" class="prism-code language-json codeBlock_11GL thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_t3ov"><span class="token-line" style="color:#bfc7d5"><span class="token plain">adc_gain = </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">参数说明：</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">第一个参数，MIC1 增益，有效范围：</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token number" style="color:rgb(247, 140, 108)">-10</span><span class="token plain">（数值越大增益越高，</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> 表示关闭）</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">第二个参数，MIC2 增益，有效范围：</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token number" style="color:rgb(247, 140, 108)">-10</span><span class="token plain">（数值越大增益越高，</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> 表示关闭）</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">第三个参数，REF1 增益，有效范围：</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token number" style="color:rgb(247, 140, 108)">-10</span><span class="token plain">（数值越大增益越高，</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> 表示关闭）</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">第四个参数，REF2 增益，有效范围：</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token number" style="color:rgb(247, 140, 108)">-10</span><span class="token plain">（数值越大增益越高，</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> 表示关闭）</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3j15 clean-btn">Copy</button></div></div><div class="codeBlockContainer_3oNM"><div class="codeBlockContent_3GwO"><pre tabindex="0" class="prism-code language-undefined codeBlock_11GL thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_t3ov"><span class="token-line" style="color:#bfc7d5"><span class="token plain">在不同设备上调试 MIC 和 REF 增益的时候，设备自播最大声音（激昂音乐或讲话稿）时录音幅值范围：</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">大概保持 mic 录音幅值 -3db~-15db</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">大概保持 ref 录音幅值 -3db~-15db</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">注意：</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">若出现 mic 截幅后者 ref 截幅，效果都会变差；</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">若 mic 录音增益过小，会造成 AGC 压力很大，听感单薄，音量小。</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3j15 clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1rmC" id="4修改4002nc源码编译后如何放到lisa项目中打包？"></a>4.修改4002NC源码编译后如何放到Lisa项目中打包？<a class="hash-link" href="#4修改4002nc源码编译后如何放到lisa项目中打包？" title="Direct link to heading">#</a></h3><ul><li>修改4002NC源码并编译生成master.bin，路径：\out\target\master.bin</li><li>将编译生成的master.bin替换Lisa项目根目录下的target\building\master.bin文件</li><li>在LStudio终端使用Lisa task build:package进行lpk打包</li><li>使用Lisa flash 进行烧录</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1rmC" id="5如何修改设备名称"></a>5.如何修改设备名称<a class="hash-link" href="#5如何修改设备名称" title="Direct link to heading">#</a></h3><p><strong>步骤1</strong> </p><div class="codeBlockContainer_3oNM"><div class="codeBlockContent_3GwO c"><pre tabindex="0" class="prism-code language-c codeBlock_11GL thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_t3ov"><span class="token-line" style="color:#bfc7d5"><span class="token plain">在</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">config</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">application</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">lini中修改如下字段</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">若无则增加</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">：</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">uac_desc_name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;LINGSI AI&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3j15 clean-btn">Copy</button></div></div><div class="codeBlockContainer_3oNM"><div class="codeBlockContent_3GwO c"><pre tabindex="0" class="prism-code language-c codeBlock_11GL thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_t3ov"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">hw_config</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">usb_mode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  uac_in_enable </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> true</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  uac_mode </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;both&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  uac_in_channel </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  custom_enable </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> false</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  uac_desc_name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;LINGSI AI&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3j15 clean-btn">Copy</button></div></div><p><strong>步骤2</strong>
编译烧录
<strong>步骤3</strong>
卸载驱动后重新插入设备。
<img src="/assets/images/卸载驱动-093adb874ce84cface9902900e6ec4c7.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1rmC" id="6如何对设备进行debug录音分析"></a>6.如何对设备进行debug录音分析<a class="hash-link" href="#6如何对设备进行debug录音分析" title="Direct link to heading">#</a></h3><p><strong>步骤1：准备 Debug 固件</strong> </p><p>对设备进行录音分析，需要烧录 debug 固件。</p><ul><li><p>如何编译 debug 固件？
在4002NC源码根目录下运行 build-uac.bat 脚本进行编译，编译固件包即为 debug 版本固件。</p></li><li><p>按照本文第4章节“4.修改4002NC源码编译后如何放到Lisa项目中打包？”指导完成debug版本固件的烧录。</p></li></ul><p><strong>步骤2：音频分析工具</strong></p><ul><li><p>录音软件：<a href="https://pc.qq.com/detail/0/detail_640.html" target="_blank" rel="noopener noreferrer">Audacity</a></p></li><li><p>音频分析软件：<a href="https://www.onlinedown.net/soft/1157792.htm" target="_blank" rel="noopener noreferrer">Adobe Audition CC</a></p></li></ul><blockquote><p>音频检查可直接通过 <a href="https://pc.qq.com/detail/0/detail_640.html" target="_blank" rel="noopener noreferrer">Audacity </a>，也可以将 Audacity 导出的音频通过 <a href="https://www.onlinedown.net/soft/1157792.htm" target="_blank" rel="noopener noreferrer">Adobe Audition CC</a> 查看。</p></blockquote><p><strong>步骤3：录音</strong></p><p>将检查对象（产品/模组/开发板）通过 USB 连接电脑，使用录音工具进行录音，对录音音频质量进行检查。</p><ul><li><p><strong>将检查对象（产品/模组/开发板）通过 USB 连接电脑;</strong></p></li><li><p><strong>PC 端播放音乐,将调试设备音量调到最大;</strong></p><p><img src="/assets/images/扬声器-b30a077e602f044f592d0df02f6ecec6.png"></p></li><li><p><strong>打开录音工具 Audacity 并完成配置：</strong></p><p>Audacity 界面配置如图标注，点击录音按钮开始录音。</p><p><img src="/assets/images/audacity配置-c0f8f627bb575119d7e5fe072353e4e3.png"></p><blockquote><p>选择 Windows WASAPI、
采样率 16000、
录音麦克风和播放设备对应的 Castor Audio，声道为 4。</p></blockquote></li><li><p><strong>录音完成后将音频导出为 wav 格式音频。</strong>
<img src="/assets/images/导出音频-c6d46b12ca32523d70bf76996885ac0d.png"></p></li></ul><p><strong>步骤4：音频分析</strong>
<strong>将增益调节到参考音频幅值。</strong>
<img src="/assets/images/音频分析-6479fddf1a076b40056f039468bfbd69.png"></p><div class="codeBlockContainer_3oNM"><div class="codeBlockContent_3GwO"><pre tabindex="0" class="prism-code language-undefined codeBlock_11GL thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_t3ov"><span class="token-line" style="color:#bfc7d5"><span class="token plain">说明：</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">第 1 路为 mic1 信号，信号幅值峰值在-3db~-15db 之间，符合录音幅值要求；</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">第 2 路为 mic2 信号，信号幅值峰值在-3db~-15db 之间，符合录音幅值要求；</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">第 3 路为 ref2 信号，信号幅值峰值在-3db~-15db 之间，符合录音幅值要求；</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">第 4 路为降噪后信号。是最终输出给上位机的音频。</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3j15 clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1rmC" id="7如何增强agc效果"></a>7.如何增强AGC效果<a class="hash-link" href="#7如何增强agc效果" title="Direct link to heading">#</a></h3><ul><li>AGC增益：</li></ul><div class="codeBlockContainer_3oNM"><div class="codeBlockContent_3GwO c"><pre tabindex="0" class="prism-code language-c codeBlock_11GL thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_t3ov"><span class="token-line" style="color:#bfc7d5"><span class="token plain">m_targetGain </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token plain">_000</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">m_MaxGain </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token plain">_000</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3j15 clean-btn">Copy</button></div></div><p>调节m_targetGain 和 m_MaxGain，增大agc增益。
m_targetGain 建议不要超过16000；
m_MaxGain 建议不要超过22000。</p><ul><li>AGC放大系数：</li></ul><div class="codeBlockContainer_3oNM"><div class="codeBlockContent_3GwO c"><pre tabindex="0" class="prism-code language-c codeBlock_11GL thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_t3ov"><span class="token-line" style="color:#bfc7d5"><span class="token plain">m_AGC_Upbound </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">m_AGC_Lowbound </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">12</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3j15 clean-btn">Copy</button></div></div><p>调节m_AGC_Upbound和m_AGC_Lowbound参数，增大AGC放大倍数。
m_AGC_Upbound 建议不超过12；
m_AGC_Lowbound 建议不超过-12。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1rmC" id="8样机调试步骤"></a>8.样机调试步骤<a class="hash-link" href="#8样机调试步骤" title="Direct link to heading">#</a></h3><p><strong>步骤1.硬件结构检查</strong></p><ul><li>震动检查</li></ul><ol><li>设备壳体自身部件间震动（比如螺丝没紧固好）。</li><li>内部线缆部件等震动。</li><li>设备内关键器件是否有软垫防震</li></ol><ul><li><p>气密性检查
检查设备气密性，腔体内是否有漏音。</p></li><li><p>环境检查
调优或测试的时候，避免设备旁边是有大面积硬质物体遮挡反射，或者避免设备在纸张上、旁边有塑料袋。</p></li></ul><p><strong>步骤2.确定speaker音量</strong></p><ul><li>根据客户需求设定喇叭输出音量最大值，可播放1KHZ 0db音频，在0cm距离测量音量分贝。</li></ul><p><strong>步骤3.录音音频检查</strong></p><ul><li>麦克风录音/回采录音
录音幅值：设备最大音自播自录mic录音和回采音频不截幅。</li></ul><p><strong>步骤4.降噪后音频效果确认</strong></p><ul><li>回声消除效果</li><li>自动增益效果</li><li>环境噪声抑制</li></ul><p><strong>参考音频</strong></p><p><a target="_blank" href="/assets/files/音频示例-be55a2c1330895aa23686ed6792c9709.wav">示例音频下载</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1rmC" id="9常见问题分析"></a>9.常见问题分析<a class="hash-link" href="#9常见问题分析" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1rmC" id="91-mic-录音幅值过小"></a>9.1 MIC 录音幅值过小<a class="hash-link" href="#91-mic-录音幅值过小" title="Direct link to heading">#</a></h4><p><strong>音频表现：</strong></p><p>最大音量播放音乐条件下，录制的音频声音幅度过小，听不清楚录音的内容，在 2 米外的人声录音几乎听不清楚。通过录音查看可发现 MIC1，MIC2 的幅度远低于-3db~-15db。</p><p><img src="/assets/images/mic增益小音频分析-e50b11beac83d94430bbbecaec5f5f9e.png"></p><p><strong>解决方案：</strong></p><p>通过调整 ADC 增益解决。</p><p>调整方向：
增大 mic 增益值。
经过多轮调节测试最终确定将 ADC mic 增益参数调整为：</p><div class="codeBlockContainer_3oNM"><div class="codeBlockContent_3GwO json"><pre tabindex="0" class="prism-code language-json codeBlock_11GL thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_t3ov"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    adc_gain = </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3j15 clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1rmC" id="92-mic-录音幅值过大（出现截幅）"></a>9.2 MIC 录音幅值过大（出现截幅）<a class="hash-link" href="#92-mic-录音幅值过大（出现截幅）" title="Direct link to heading">#</a></h4><p><strong>音频表现：</strong></p><p>最大音量播放音乐条件下，录音出现截幅现象。</p><p><img src="/assets/images/mic增过大音频分析-70ef5ed4dff53722d6ca5bb3dc594202.png"></p><p><strong>解决方案：</strong>
调整增益。</p><p>调整方向：
减小 mic 增益值。
经过多轮调节测试最终确定将 ADC mic 增益参数调整为</p><div class="codeBlockContainer_3oNM"><div class="codeBlockContent_3GwO json"><pre tabindex="0" class="prism-code language-json codeBlock_11GL thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_t3ov"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    adc_gain = </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3j15 clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1rmC" id="93-回采录音过小"></a>9.3 回采录音过小<a class="hash-link" href="#93-回采录音过小" title="Direct link to heading">#</a></h4><p><strong>音频表现：</strong></p><p>回采录音信号幅值低于-3db~-15db,且远低于 mic 信号幅值，回采信号幅值过小会影响回声消除效果。</p><p><img src="/assets/images/ref增过小音频分析-82b41182bb74ac17e2d80ebf7903e2bc.png"></p><p><strong>解决方案：</strong>
调节增益。</p><p>调整方向：
增大 ref 增益值。
经过多轮调节测试最终确定将 ADC ref 增益参数调整为：</p><div class="codeBlockContainer_3oNM"><div class="codeBlockContent_3GwO json"><pre tabindex="0" class="prism-code language-json codeBlock_11GL thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_t3ov"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    adc_gain = </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3j15 clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1rmC" id="94-回采录音过大（出现截幅）"></a>9.4 回采录音过大（出现截幅）<a class="hash-link" href="#94-回采录音过大（出现截幅）" title="Direct link to heading">#</a></h4><p><strong>音频表现：</strong></p><p>最大音量播放音乐条件下，回采录音信号幅值高于-3db~-15db,并出现截幅。</p><p><img src="/assets/images/ref增过大音频分析-b0afdfd507518efc4654d2db4a35ec08.png"></p><p><strong>解决方案：</strong>
调整增益。
调整方向：
增大 ref 增益值。
经过多轮调节测试最终确定将 ADC mic 增益参数调整为：</p><div class="codeBlockContainer_3oNM"><div class="codeBlockContent_3GwO json"><pre tabindex="0" class="prism-code language-json codeBlock_11GL thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_t3ov"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    adc_gain = </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_3j15 clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1rmC" id="95-音频失真"></a>9.5 音频失真<a class="hash-link" href="#95-音频失真" title="Direct link to heading">#</a></h4><p>音频失真表现：
降噪后音频出现电音、模糊、卡顿等现象，与音源有明显差异。
示例：
音频波形正常，但音频播放模糊不清，存在失真现象。
<a target="_blank" href="/assets/files/录音异常-1d4595bf35ae1676725eaf0b8ada6f17.wav">示例音频下载</a></p><p>若发现音频失真，请通过工单反馈：<a href="https://open.listenai.com/cloud_project" target="_blank" rel="noopener noreferrer">工单指引</a></p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1rmC" id="96-音频底噪"></a>9.6 音频底噪<a class="hash-link" href="#96-音频底噪" title="Direct link to heading">#</a></h4><p>底噪表现：
安静环境下，录音底噪&gt;-35db,存在明显底噪。</p><p><img src="/assets/images/底噪大-2522648de867fbf4495598aa0b56eb90.png"></p><p><a target="_blank" href="/assets/files/录音异常-1d4595bf35ae1676725eaf0b8ada6f17.wav">示例音频下载</a></p><p><strong>底噪来源分析：</strong></p><ul><li>硬件电路底噪
排查方法：拔掉 mic 进行录音测试，如果存在底噪则说明底噪来自硬件电路。</li><li>mic 本身拾音带来底噪
排查方法：排除硬件电路底噪后，mic 原始录音即存在明显底噪，则可判断为 mic 录音底噪。通常由于麦克风灵敏度等问题导致底噪。</li><li>算法处理后产生底噪
排查方法：排除硬件底噪和 mic 本身拾音产生底噪后，音频通过算法处理后有明显底噪，则可判断为算法处理后产生了底噪。</li></ul><blockquote><p>注意事项：
需要在安静环境下进行测试，并排除空调、风扇、固定噪声等音源的影响。</p></blockquote><p><strong>底噪解决方案</strong></p><ul><li>硬件电路导致底噪
排查硬件电路，确定底噪干扰源。</li><li>mic 本身拾音带来底噪
更换优质 mic 解决底噪问题。</li><li>算法产生底噪
请通过工单反馈：<a href="https://open.listenai.com/cloud_project" target="_blank" rel="noopener noreferrer">工单指引</a></li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_1rmC" id="97-回声消除效果差"></a>9.7 回声消除效果差<a class="hash-link" href="#97-回声消除效果差" title="Direct link to heading">#</a></h4><p><strong>回声消除效果差音频表现：</strong></p><p>安静环境下进行录音分析，与标准音频对比，算法处理后音频能明显听到设备自播残留声音。</p><p>示例音频：
<a target="_blank" href="/assets/files/回声消除效果差-eba386b1902545ec8d6a8195dc8c656d.wav">示例音频下载</a></p><p><strong>解决方案：</strong></p><ul><li>确定 mic 音频和回采音频已经达到幅值参考要求；</li><li>确定 mic 录音音频是否存在失真问题,录音无明显异常；</li><li>确定 ref 音频是否存在失真问题,录音无明显异常；</li><li>以上问题都排除之后问题仍存在，请通过工单反馈：<a href="https://open.listenai.com/cloud_project" target="_blank" rel="noopener noreferrer">工单指引</a>。</li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/Industrysolution/Conference_calling_solutions/softwaredevelopment/create_project"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« 使用 LISA 创建 4002NC 项目</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav><div class="gitalk-wrapper"><ul class="gitalk-option"><li class="like"><i class="icon like-icon"></i> <span id="like_num">有帮助  0</span></li><li class="unlike"><i class="icon unlike-icon"></i> <span id="unlike_num">没帮助 0</span></li><li>文档反馈</li></ul></div></div></div><div class="col col--3" style="padding-left:0px"><div class="tableOfContents_9Tj1 thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1常用lisa命令" class="table-of-contents__link">1.常用Lisa命令</a></li><li><a href="#2如何设置设备输出音量的最大值和最小值" class="table-of-contents__link">2.如何设置设备输出音量的最大值和最小值</a></li><li><a href="#3如何修改mic增益和回采增益" class="table-of-contents__link">3.如何修改mic增益和回采增益</a></li><li><a href="#4修改4002nc源码编译后如何放到lisa项目中打包？" class="table-of-contents__link">4.修改4002NC源码编译后如何放到Lisa项目中打包？</a></li><li><a href="#5如何修改设备名称" class="table-of-contents__link">5.如何修改设备名称</a></li><li><a href="#6如何对设备进行debug录音分析" class="table-of-contents__link">6.如何对设备进行debug录音分析</a></li><li><a href="#7如何增强agc效果" class="table-of-contents__link">7.如何增强AGC效果</a></li><li><a href="#8样机调试步骤" class="table-of-contents__link">8.样机调试步骤</a></li><li><a href="#9常见问题分析" class="table-of-contents__link">9.常见问题分析</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 安徽聆思智能科技有限公司皖ICP备05001217号</div></div></div></footer></div>
<script src="/assets/js/runtime~main.169e3d54.js"></script>
<script src="/assets/js/main.d12433d4.js"></script>
</body>
</html>