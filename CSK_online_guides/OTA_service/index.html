<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<title data-react-helmet="true">OTA服务 | 聆思文档中心</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="OTA服务 | 聆思文档中心"><meta data-react-helmet="true" name="description" content="本文主要介绍离在线方案的 OTA 服务，通过阅读本文，你将了解到："><meta data-react-helmet="true" property="og:description" content="本文主要介绍离在线方案的 OTA 服务，通过阅读本文，你将了解到："><meta data-react-helmet="true" property="og:url" content="https://github.com/LISTENAI/CSK_online_guides/OTA_service"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://github.com/LISTENAI/CSK_online_guides/OTA_service"><link rel="stylesheet" href="/styles.16a99837.css">
<link rel="preload" href="/styles.a415eef2.js" as="script">
<link rel="preload" href="/runtime~main.db326cd7.js" as="script">
<link rel="preload" href="/main.6c23daca.js" as="script">
<link rel="preload" href="/1.f5c93ba5.js" as="script">
<link rel="preload" href="/2.60916f76.js" as="script">
<link rel="preload" href="/1a4e3797.db8344af.js" as="script">
<link rel="preload" href="/1be78505.34f4f775.js" as="script">
<link rel="preload" href="/70.8fbb44b1.js" as="script">
<link rel="preload" href="/69.49228842.js" as="script">
<link rel="preload" href="/935f2afb.3167cd55.js" as="script">
<link rel="preload" href="/17896441.e5497843.js" as="script">
<link rel="preload" href="/48deb7b9.cc1c6279.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="LSOpen Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.png" alt="LSOpen Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">聆思文档中心</strong></a><a class="navbar__item navbar__link" href="/CSK_online_guides_home">离在线开发指南</a><a class="navbar__item navbar__link" href="/csksdk_api">API</a><a class="navbar__item navbar__link" href="/download">下载中心</a><a class="navbar__item navbar__link" href="/lisa">Hello Lisa</a><a class="navbar__item navbar__link" href="/school">视频教程</a></div><div class="navbar__items navbar__items--right"><a href="https://cloud.listenai.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">LSCloud</a><div class="navbar__search searchBarContainer_1-U_"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_18Th searchBarLoadingRing_zYFK"><div></div><div></div><div></div><div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="LSOpen Logo" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/logo.png" alt="LSOpen Logo" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">聆思文档中心</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/CSK_online_guides_home">离在线开发指南</a></li><li class="menu__list-item"><a class="menu__link" href="/csksdk_api">API</a></li><li class="menu__list-item"><a class="menu__link" href="/download">下载中心</a></li><li class="menu__list-item"><a class="menu__link" href="/lisa">Hello Lisa</a></li><li class="menu__list-item"><a class="menu__link" href="/school">视频教程</a></li><li class="menu__list-item"><a href="https://cloud.listenai.com" target="_blank" rel="noopener noreferrer" class="menu__link">LSCloud</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_U38p"><div class="docItemContainer_a7m4"><article><header><h1 class="docTitle_Oumm">OTA服务</h1></header><div class="markdown"><blockquote><p>本文主要介绍离在线方案的 OTA 服务，通过阅读本文，你将了解到：</p><p>1.OTA 文件说明</p><p>2.OTA 服务运行流程，</p><p>3.如何在 iFLYOS 上配置 OTA 文件</p><p>4.固件源码中 OTA SDK 的使用说明</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="1ota文件说明"></a>1.OTA文件说明<a class="hash-link" href="#1ota文件说明" title="Direct link to heading">#</a></h2><p>OTA 包由三部分组成，分别是 <strong>info.txt</strong>、<strong>WIFi SOC  固件</strong>、<strong>CSK 固件</strong>，本文以 CSK+XR872AT 方案的 OTA 为例：</p><p>WIFi SOC 固件包，如 XR872AT.img；</p><p>CSK 固件包，包括 flashboot、respak.bin、master.bin，burner.img；</p><p>info.txt 是一个配置文件，描述 OTA 的具体升级信息，示例如下：</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-c codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token string" style="color:rgb(195, 232, 141)">&quot;version&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">10020</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token string" style="color:rgb(195, 232, 141)">&quot;xr872&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token string" style="color:rgb(195, 232, 141)">&quot;version&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">10020</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token string" style="color:rgb(195, 232, 141)">&quot;file_size&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">47920</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token string" style="color:rgb(195, 232, 141)">&quot;md5&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;0AC03421791CDFFB7B73E8AA7B0FD8B4&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token string" style="color:rgb(195, 232, 141)">&quot;file_path&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;files/xr872.img&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;castor&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;version&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">1001</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;file_size&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">47920</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;md5&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;0AC03421791CDFFB7B73E8AA7B0FD8B4&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;file_path&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;files/burner.img&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;version&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">1001</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;file_size&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">18280</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;md5&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;394474A9B07DCDA2233C676CC24EFD45&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;file_path&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;files/flashboot.bin&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;addr&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;0x0&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;version&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">1001</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;file_size&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">417164</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;md5&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;5DEBA6B85BEC67ED8A0C6438BBCAE1F9&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;file_path&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;files/master.bin&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;addr&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;0x10000&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;version&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">1001</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;file_size&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token number" style="color:rgb(247, 140, 108)">3652226</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;md5&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;42EEFF98DD52E0189858C221330A1C85&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;file_path&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;files/respak.bin&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;addr&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;0x100000&quot;</span><span class="token plain">  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><table><thead><tr><th><strong>字段名</strong></th><th><strong>字段说明</strong></th></tr></thead><tbody><tr><td>version</td><td>此次 OTA 的版本号，必须比前版本大，只要有 XR872AT 或者 CSK 中的一 个需要升级都需增加此版本号</td></tr><tr><td>xr872</td><td>此次 OTA 中 XR872AT 固件相关信息，如果 XR872AT 不升级，可不需要</td></tr><tr><td>xr872.version</td><td>XR872AT 固件版本号</td></tr><tr><td>xr872.file_size</td><td>XR872AT 固件大小</td></tr><tr><td>xr872.md5</td><td>XR872AT 固件MD5</td></tr><tr><td>xr872.file_path</td><td>XR872AT 固件文件路径（ files/xr872 文件名），需跟上传的 XR872AT 文件名 一致，会通过 url + file_path 进行 OTA</td></tr><tr><td>castor</td><td>此次 OTA 中 CSK 相关信息，如果 CSK 不升级，可不需要</td></tr><tr><td>castor[i].version</td><td>CSK 固件子包版本号，master.bin的版本号为主，<strong>默认为1000</strong></td></tr><tr><td>castor[i].file_size</td><td>CSK 固件子包文件大小</td></tr><tr><td>castor[i].md5</td><td>CSK 固件子包 md5</td></tr><tr><td>castor[i].file_path</td><td>CSK 固件子包路径（ files /子包文件名），需跟上传的文件名一致， 会通过 url + file_path 进行 OTA</td></tr><tr><td>castor[i].addr</td><td>CSK固件子包地址，烧录固件时会对子包地址进行校验，校验通过方可烧录成功</td></tr></tbody></table><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="2ota-业务流程"></a>2.OTA 业务流程<a class="hash-link" href="#2ota-业务流程" title="Direct link to heading">#</a></h2><p>整体流程见下图：</p><ul><li>触发检查更新条件时，设备端会请求 iFLYOS 自动更新API</li><li>云端返回固件 <strong>info.txt</strong> 和固件下载地址。</li><li>解析 info.txt 文件，将解析出的 <code>version</code> 与固件本地的 <code>version</code>，若云端 <code>version</code> 大于固件 <code>version</code>，则说明有可用更新，进入下一步流程；</li><li>根据 info.txt 的内容，解析出云端固件包的内容，通常来说，固件包有三种情况：仅 CSK 固件、仅 XR872AT 固件、CSK 固件和  XR872AT 固件均更新。</li><li>若仅 CSK 更新，则 XR872AT 将固件下载下来后，通过串口传输至 CSK 中，由 CSK 实现固件更新；</li><li>若仅 XR872AT 更新，则通过 A/B update 的形式实现固件更新；</li><li>若 CSK 和 XR872AT 均更新，则先完成 XR872AT固件更新，之后 XR872AT再将可用更新传至 CSK 中；</li></ul><p><img src="/assets/images/OTA_PROCESS-1211428f4b00cdf48f77829e5893ff0b.jpg"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="3如何在-iflyos-上配置ota文件"></a>3.如何在 iFLYOS 上配置OTA文件<a class="hash-link" href="#3如何在-iflyos-上配置ota文件" title="Direct link to heading">#</a></h2><p>你需要在 iFLYOS 平台的【自动更新】菜单栏上传固件包，操作说明如下：</p><p><img src="/assets/images/iFLYOS_OTA-f5388e3f2fb41ef56418bbe37ef5652e.png"></p><ul><li><p>配置 OTA 固件时，索引配置文件必须命名为 <strong>info.txt</strong>。</p></li><li><p>平台配置 OTA，info.txt 中 file_path 必须为 <strong>files/文件名</strong> 的形式。</p></li><li><p>CSK 固件升级主要是检查 file_path 为 master.bin 的 <code>version</code>，其余子包 <code>version</code> 均为预留字段，建议 CSK 固件升级将 CSK 字段下的子包 <code>version</code> 均统一增加，如果不需要升级 CSK 固件不用添加 CSK 信息。</p></li><li><p>OS平台配置后，可通过重启设备或【小飞在线】APP 检查更新来进行 OTA 升级。</p></li></ul><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>1.OTA 服务是可选项，如果你有自己的 OTA 服务，也可自行实现 OTA 功能。</p><p>2.请确保固件中的 <code>OTA_SECRET</code> 字段与 iFLYOS 中保持一致，否则即使云端有可用更新，也会因校验不通过而 OTA 失败。</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="4ota-sdk-使用说明"></a>4.OTA SDK 使用说明<a class="hash-link" href="#4ota-sdk-使用说明" title="Direct link to heading">#</a></h2><p>接下来为你介绍 OTA 相关接口，有助于你实现 OTA 模块的二次开发。</p><ul><li><strong>EVS OTA接口</strong></li></ul><p>固件源码中，与 iFLYOS 平台 OTA 服务交互的相关逻辑在 <code>listenai_sdk/modules/listenai_evs/evs_ota.c</code> 中，主要包括以下功能接口。</p><table><thead><tr><th><strong>函数名</strong></th><th><strong>功能说明</strong></th><th><strong>参数与备注</strong></th></tr></thead><tbody><tr><td>evs_ota_init</td><td>初始化</td><td>参数为一些 OTA 事件回调</td></tr><tr><td>evs_ota_check_version</td><td>检查版本，可获取具体检查结 果</td><td></td></tr><tr><td>evs_ota_update_new_version</td><td>检查版本，通过回调的形式通 知是否需要升级</td><td></td></tr><tr><td>evs_ota_start_update</td><td>开始升级， evs_ota_update_new_version 后可通过此接口升级</td><td>与 evs_ota_update_new_version 搭配使用，分开是为了在检查和升级中  有一些自定义动作，可控流程</td></tr><tr><td>evs_ota_get_state</td><td>获取当前 OTA 状态</td><td></td></tr><tr><td>evs_ota_destroy</td><td>销毁</td><td></td></tr></tbody></table><p>以下为OTA接口调用的过程中，一些回调通知事件。</p><table><thead><tr><th><strong>事件名</strong></th><th><strong>功能说明</strong></th><th><strong>备注</strong></th></tr></thead><tbody><tr><td>OTA_EVENT_NEW_VERSION</td><td>检查到新版本</td><td>evs_ota_update_new_version 接口调用后通知的事件</td></tr><tr><td>OTA_EVENT_START</td><td>开始升级</td><td>evs_ota_start_update 接口调用后通知的事件</td></tr><tr><td>OTA_EVENT_START_FAILED</td><td>开始升级失败</td><td>evs_ota_start_update 接口调用后通知的事件</td></tr><tr><td>OTA_EVENT_SUCCESS</td><td>升级流程成功</td><td>evs_ota_start_update 接口调用后通知的事件</td></tr><tr><td>OTA_EVENT_FAILED</td><td>升级失败</td><td>evs_ota_start_update 接口调用后通知的事件</td></tr><tr><td>OTA_EVENT_UPGRADE_OK</td><td>重启后检查确认 升级成功</td><td>重启后检查升级成功通知的事件</td></tr><tr><td>OTA_EVENT_NONE</td><td>无新版本</td><td>evs_ota_update_new_version 接口调 用后通知的事件</td></tr></tbody></table><p><strong>Castor_EVB</strong> <strong>OTA接口</strong></p><p>Castor_EVB 整套通用 OTA 方案，包括 XR872AT 和 CSK 升级，代码在 <code>listenai_sdk/drivers/listenai_ota/evs_castor_ota.c</code> 中，主要包含以下接口。</p><table><thead><tr><th><strong>函数名</strong></th><th><strong>功能说明</strong></th><th><strong>参数与备注</strong></th></tr></thead><tbody><tr><td>evs_ota_process</td><td>OTA 升级接口</td><td>参数为OTA配置文件的 url 地址，调用此接口便可通过配置信息进行 OTA 升级。返回 -1 表示检查配置失败，返回 -2 表示不需要更新</td></tr><tr><td>evs_xr872_get_info</td><td>通过配置文件获取XR872AT 固件信息</td><td></td></tr><tr><td>evs_castor_get_info</td><td>通过配文件获取 CSK 固件信息</td><td></td></tr><tr><td>evs_castor_flashboot_get_info</td><td>通过配置文件获取 CSK 固件信息</td><td></td></tr><tr><td>evs_castor_uart_get_info</td><td>通过配置文件获取 CSK 固件信息</td><td></td></tr><tr><td>evs_castor_respak_get_info</td><td>通过配置文件获取 CSK 固件信息</td><td></td></tr><tr><td>evs_get_version</td><td>获取当前默认 OTA 版本</td><td>需 flash 存储 OTA 版本号，否则此为默认版 本</td></tr></tbody></table><p>以下为 OTA 接口调用的过程中，一些回调通知事件。</p><table><thead><tr><th><strong>事件名</strong></th><th><strong>功能说明</strong></th><th><strong>备注</strong></th></tr></thead><tbody><tr><td>e_ota_start</td><td>开始 OTA 升级</td><td>evs_ota_process 调用后检查需要更新后通知的事件</td></tr><tr><td>e_ota_success</td><td>OTA 升级成功</td><td>evs_ota_process 调用后升级成功通知的事件</td></tr><tr><td>e_ota_failed</td><td>OTA 升级失败</td><td>evs_ota_process 调用后升级失败通知的事件</td></tr></tbody></table><p><strong>XR872AT OTA 接口</strong></p><p>XR872AT 固件升级接口，代码在 listenai_sdk/drivers/listenai_ota/evs_xr872_ota.c 中，主要包含以下接口。</p><table><thead><tr><th><strong>函数名</strong></th><th><strong>功能说明</strong></th><th>参数与备注**</th></tr></thead><tbody><tr><td>evs_xr872_ota_http</td><td>XR872AT http升级接口</td><td>参数为 XR872AT 固件包 url，返回-1表示升 级失败</td></tr><tr><td>evs_xr872_get_version</td><td>XR872AT 当前固件版本号</td><td></td></tr></tbody></table><p><strong>Castor_EVB 版本号信息</strong></p><p>Castor_EVB 版本号和版本名信息在 listenai_sdk/listenai_version.h 中。</p><table><thead><tr><th><strong>字段名</strong></th><th><strong>功能说明</strong></th><th><strong>备注</strong></th></tr></thead><tbody><tr><td>CASTOR_VERSION_DEFAULT</td><td>CSK 默认版本号</td><td></td></tr><tr><td>XR872_VERSION</td><td>XR872AT 版本号</td><td>主版本号+次版本号+修订号形式</td></tr><tr><td>OTA_VERSION_DEFAULT</td><td>OTA 方案默认版本号</td><td>需 flash 存储在线 OTA 版本号，否则此为默认版本</td></tr></tbody></table></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1ota文件说明" class="table-of-contents__link">1.OTA文件说明</a></li><li><a href="#2ota-业务流程" class="table-of-contents__link">2.OTA 业务流程</a></li><li><a href="#3如何在-iflyos-上配置ota文件" class="table-of-contents__link">3.如何在 iFLYOS 上配置OTA文件</a></li><li><a href="#4ota-sdk-使用说明" class="table-of-contents__link">4.OTA SDK 使用说明</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 安徽聆思智能科技有限公司皖ICP备05001217号</div></div></div></footer></div>
<script src="/styles.a415eef2.js"></script>
<script src="/runtime~main.db326cd7.js"></script>
<script src="/main.6c23daca.js"></script>
<script src="/1.f5c93ba5.js"></script>
<script src="/2.60916f76.js"></script>
<script src="/1a4e3797.db8344af.js"></script>
<script src="/1be78505.34f4f775.js"></script>
<script src="/70.8fbb44b1.js"></script>
<script src="/69.49228842.js"></script>
<script src="/935f2afb.3167cd55.js"></script>
<script src="/17896441.e5497843.js"></script>
<script src="/48deb7b9.cc1c6279.js"></script>
</body>
</html>